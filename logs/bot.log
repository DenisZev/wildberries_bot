2025-03-02 01:58:31,037 - DEBUG - matplotlib data path: C:\Users\zevae\PycharmProjects\wildberries_bot\.venv\Lib\site-packages\matplotlib\mpl-data
2025-03-02 01:58:31,110 - DEBUG - CONFIGDIR=C:\Users\zevae\.matplotlib
2025-03-02 01:58:31,110 - DEBUG - interactive is False
2025-03-02 01:58:31,110 - DEBUG - platform is win32
2025-03-02 01:58:31,177 - DEBUG - CACHEDIR=C:\Users\zevae\.matplotlib
2025-03-02 01:58:31,185 - DEBUG - Using fontManager instance from C:\Users\zevae\.matplotlib\fontlist-v390.json
2025-03-02 01:58:31,540 - DEBUG - Looking up time zone info from registry
2025-03-02 01:58:31,622 - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-03-02 01:58:31,622 - INFO - Starting bot...
2025-03-02 01:58:31,622 - DEBUG - Using proactor: IocpProactor
2025-03-02 01:58:31,624 - DEBUG - Calling Bot API endpoint `getMe` with parameters `{}`
2025-03-02 01:58:31,627 - DEBUG - connect_tcp.started host='api.telegram.org' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-02 01:58:31,889 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001DF7294B350>
2025-03-02 01:58:31,889 - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001DF72E98290> server_hostname='api.telegram.org' timeout=5.0
2025-03-02 01:58:32,108 - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001DF72896550>
2025-03-02 01:58:32,109 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-02 01:58:32,109 - DEBUG - send_request_headers.complete
2025-03-02 01:58:32,109 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-02 01:58:32,109 - DEBUG - send_request_body.complete
2025-03-02 01:58:32,109 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-02 01:58:32,238 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Server', b'nginx/1.18.0'), (b'Date', b'Sat, 01 Mar 2025 19:02:07 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'244'), (b'Connection', b'keep-alive'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Allow-Methods', b'GET, POST, OPTIONS'), (b'Access-Control-Expose-Headers', b'Content-Length,Content-Type,Date,Server,Connection')])
2025-03-02 01:58:32,238 - INFO - HTTP Request: POST https://api.telegram.org/bot7210035997:AAETKsY0RI_BnKZNngKY-raSz7mrVRkDmlo/getMe "HTTP/1.1 200 OK"
2025-03-02 01:58:32,238 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-02 01:58:32,238 - DEBUG - receive_response_body.complete
2025-03-02 01:58:32,238 - DEBUG - response_closed.started
2025-03-02 01:58:32,238 - DEBUG - response_closed.complete
2025-03-02 01:58:32,239 - DEBUG - Call to Bot API endpoint `getMe` finished with return value `{'id': 7210035997, 'is_bot': True, 'first_name': 'BotWb', 'username': 'WBZev_bot', 'can_join_groups': True, 'can_read_all_group_messages': False, 'supports_inline_queries': False, 'can_connect_to_business': False, 'has_main_web_app': False}`
2025-03-02 01:58:32,239 - DEBUG - This Bot is already initialized.
2025-03-02 01:58:32,239 - DEBUG - Updater started (polling)
2025-03-02 01:58:32,239 - DEBUG - Start network loop retry bootstrap del webhook
2025-03-02 01:58:32,239 - DEBUG - Deleting webhook
2025-03-02 01:58:32,239 - DEBUG - Calling Bot API endpoint `deleteWebhook` with parameters `{}`
2025-03-02 01:58:32,239 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-02 01:58:32,239 - DEBUG - send_request_headers.complete
2025-03-02 01:58:32,240 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-02 01:58:32,240 - DEBUG - send_request_body.complete
2025-03-02 01:58:32,240 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-02 01:58:32,328 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Server', b'nginx/1.18.0'), (b'Date', b'Sat, 01 Mar 2025 19:02:07 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'68'), (b'Connection', b'keep-alive'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Allow-Methods', b'GET, POST, OPTIONS'), (b'Access-Control-Expose-Headers', b'Content-Length,Content-Type,Date,Server,Connection')])
2025-03-02 01:58:32,328 - INFO - HTTP Request: POST https://api.telegram.org/bot7210035997:AAETKsY0RI_BnKZNngKY-raSz7mrVRkDmlo/deleteWebhook "HTTP/1.1 200 OK"
2025-03-02 01:58:32,328 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-02 01:58:32,328 - DEBUG - receive_response_body.complete
2025-03-02 01:58:32,328 - DEBUG - response_closed.started
2025-03-02 01:58:32,328 - DEBUG - response_closed.complete
2025-03-02 01:58:32,328 - DEBUG - Call to Bot API endpoint `deleteWebhook` finished with return value `True`
2025-03-02 01:58:32,328 - DEBUG - Bootstrap done
2025-03-02 01:58:32,328 - DEBUG - Waiting for polling to start
2025-03-02 01:58:32,328 - DEBUG - Polling updates from Telegram started
2025-03-02 01:58:32,328 - DEBUG - Start network loop retry getting Updates
2025-03-02 01:58:32,328 - DEBUG - Calling Bot API endpoint `getUpdates` with parameters `{'timeout': 10, 'offset': 0}`
2025-03-02 01:58:32,329 - INFO - Added job "start_scheduler" to job store "default"
2025-03-02 01:58:32,329 - INFO - Scheduler started
2025-03-02 01:58:32,329 - DEBUG - JobQueue started
2025-03-02 01:58:32,329 - INFO - Application started
2025-03-02 01:58:32,329 - DEBUG - connect_tcp.started host='api.telegram.org' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-02 01:58:32,329 - DEBUG - Looking for jobs to run
2025-03-02 01:58:32,329 - INFO - Removed job c607903a14a84be8bfefd9a537726609
2025-03-02 01:58:32,329 - DEBUG - No jobs; waiting until a job is added
2025-03-02 01:58:32,329 - INFO - Running job "start_scheduler (trigger: date[2025-03-01 18:58:31 UTC], next run at: 2025-03-01 18:58:31 UTC)" (scheduled at 2025-03-01 18:58:31.621356+00:00)
2025-03-02 01:58:32,329 - INFO - Starting scheduler...
2025-03-02 01:58:32,331 - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-03-02 01:58:32,334 - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-03-02 01:58:32,334 - INFO - Added job "check_for_new_orders" to job store "default"
2025-03-02 01:58:32,334 - INFO - Added job "weekly_sales_report" to job store "default"
2025-03-02 01:58:32,334 - INFO - Scheduler started
2025-03-02 01:58:32,334 - DEBUG - Looking for jobs to run
2025-03-02 01:58:32,334 - DEBUG - Next wakeup is due at 2025-03-02 02:00:32.331603+07:00 (in 119.996833 seconds)
2025-03-02 01:58:32,334 - INFO - Job "start_scheduler (trigger: date[2025-03-01 18:58:31 UTC], next run at: 2025-03-01 18:58:31 UTC)" executed successfully
2025-03-02 01:58:32,587 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001DF73ED1890>
2025-03-02 01:58:32,587 - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001DF72E98200> server_hostname='api.telegram.org' timeout=5.0
2025-03-02 01:58:32,781 - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001DF73EBFED0>
2025-03-02 01:58:32,782 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-02 01:58:32,782 - DEBUG - send_request_headers.complete
2025-03-02 01:58:32,782 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-02 01:58:32,782 - DEBUG - send_request_body.complete
2025-03-02 01:58:32,782 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-02 01:58:42,889 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Server', b'nginx/1.18.0'), (b'Date', b'Sat, 01 Mar 2025 19:02:18 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'23'), (b'Connection', b'keep-alive'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Allow-Methods', b'GET, POST, OPTIONS'), (b'Access-Control-Expose-Headers', b'Content-Length,Content-Type,Date,Server,Connection')])
2025-03-02 01:58:42,889 - INFO - HTTP Request: POST https://api.telegram.org/bot7210035997:AAETKsY0RI_BnKZNngKY-raSz7mrVRkDmlo/getUpdates "HTTP/1.1 200 OK"
2025-03-02 01:58:42,889 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-02 01:58:42,889 - DEBUG - receive_response_body.complete
2025-03-02 01:58:42,889 - DEBUG - response_closed.started
2025-03-02 01:58:42,889 - DEBUG - response_closed.complete
2025-03-02 01:58:42,889 - DEBUG - Call to Bot API endpoint `getUpdates` finished with return value `[]`
2025-03-02 01:58:42,889 - DEBUG - No new updates found.
2025-03-02 01:58:42,889 - DEBUG - Calling Bot API endpoint `getUpdates` with parameters `{'timeout': 10, 'offset': 0}`
2025-03-02 01:58:42,890 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-02 01:58:42,890 - DEBUG - send_request_headers.complete
2025-03-02 01:58:42,890 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-02 01:58:42,890 - DEBUG - send_request_body.complete
2025-03-02 01:58:42,890 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-02 01:58:49,154 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Server', b'nginx/1.18.0'), (b'Date', b'Sat, 01 Mar 2025 19:02:24 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'394'), (b'Connection', b'keep-alive'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Allow-Methods', b'GET, POST, OPTIONS'), (b'Access-Control-Expose-Headers', b'Content-Length,Content-Type,Date,Server,Connection')])
2025-03-02 01:58:49,154 - INFO - HTTP Request: POST https://api.telegram.org/bot7210035997:AAETKsY0RI_BnKZNngKY-raSz7mrVRkDmlo/getUpdates "HTTP/1.1 200 OK"
2025-03-02 01:58:49,154 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-02 01:58:49,155 - DEBUG - receive_response_body.complete
2025-03-02 01:58:49,155 - DEBUG - response_closed.started
2025-03-02 01:58:49,155 - DEBUG - response_closed.complete
2025-03-02 01:58:49,155 - DEBUG - Call to Bot API endpoint `getUpdates` finished with return value `[{'update_id': 270661546, 'message': {'message_id': 1503, 'from': {'id': 6626623279, 'is_bot': False, 'first_name': 'Денис', 'language_code': 'ru'}, 'chat': {'id': 6626623279, 'first_name': 'Денис', 'type': 'private'}, 'date': 1740855744, 'text': '/sales_report 2025-02-01 2025-03-01', 'entities': [{'offset': 0, 'length': 13, 'type': 'bot_command'}]}}]`
2025-03-02 01:58:49,155 - DEBUG - Getting updates: [270661546]
2025-03-02 01:58:49,156 - DEBUG - Processing update Update(message=Message(channel_chat_created=False, chat=Chat(first_name='Денис', id=6626623279, type=<ChatType.PRIVATE>), date=datetime.datetime(2025, 3, 1, 19, 2, 24, tzinfo=datetime.timezone.utc), delete_chat_photo=False, entities=(MessageEntity(length=13, offset=0, type=<MessageEntityType.BOT_COMMAND>),), from_user=User(first_name='Денис', id=6626623279, is_bot=False, language_code='ru'), group_chat_created=False, message_id=1503, supergroup_chat_created=False, text='/sales_report 2025-02-01 2025-03-01'), update_id=270661546)
2025-03-02 01:58:49,156 - INFO - Fetching sales report from 2025-02-01 to 2025-03-01
2025-03-02 01:58:49,164 - DEBUG - Calling Bot API endpoint `getUpdates` with parameters `{'timeout': 10, 'offset': 270661547}`
2025-03-02 01:58:49,164 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-02 01:58:49,165 - DEBUG - send_request_headers.complete
2025-03-02 01:58:49,165 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-02 01:58:49,165 - DEBUG - send_request_body.complete
2025-03-02 01:58:49,165 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-02 01:58:49,988 - INFO - Received 57 sales records
2025-03-02 01:58:49,988 - DEBUG - Sample data: [{'realizationreport_id': 296456615, 'date_from': '2025-01-27', 'date_to': '2025-02-02', 'create_dt': '2025-02-03', 'currency_name': 'RUB', 'suppliercontract_code': None, 'rrd_id': 2893379263804, 'gi_id': 0, 'dlv_prc': 0, 'fix_tariff_date_from': '', 'fix_tariff_date_to': '', 'subject_name': 'Удобрения для растений', 'nm_id': 312122034, 'brand_name': 'Фульвогумат Иван Овсинский', 'sa_name': 'триходерма1литр', 'ts_name': '0', 'barcode': '2013533560000', 'doc_type_name': '', 'quantity': 0, 'retail_price': 0, 'retail_amount': 0, 'sale_percent': 0, 'commission_percent': 0, 'office_name': 'Склад поставщика - везу на склад WB', 'supplier_oper_name': 'Логистика', 'order_dt': '2025-01-25T10:07:43Z', 'sale_dt': '2025-02-01T14:49:49Z', 'rr_dt': '2025-02-01', 'shk_id': 29933166348, 'retail_price_withdisc_rub': 0, 'delivery_amount': 1, 'return_amount': 0, 'delivery_rub': 41.64, 'gi_box_type_name': '', 'product_discount_for_report': 0, 'supplier_promo': 0, 'rid': 0, 'ppvz_spp_prc': 0, 'ppvz_kvw_prc_base': 0, 'ppvz_kvw_prc': 0, 'sup_rating_prc_up': 0, 'is_kgvp_v2': 0, 'ppvz_sales_commission': 0, 'ppvz_for_pay': 0, 'ppvz_reward': 0, 'acquiring_fee': 0, 'acquiring_percent': 0, 'payment_processing': '', 'acquiring_bank': '', 'ppvz_vw': 0, 'ppvz_vw_nds': 0, 'ppvz_office_name': 'Московская область деревня Духанино 57с2', 'ppvz_office_id': 50031081, 'ppvz_supplier_id': 0, 'ppvz_supplier_name': '', 'ppvz_inn': '', 'declaration_number': '', 'bonus_type_name': 'К клиенту при продаже', 'sticker_id': '29933166348', 'site_country': 'Россия', 'srv_dbs': False, 'penalty': 0, 'additional_payment': 0, 'rebill_logistic_cost': 0, 'storage_fee': 0, 'deduction': 0, 'acceptance': 0, 'assembly_id': 2875983258, 'srid': '7949337545312106843.2.0', 'report_type': 1, 'is_legal_entity': False, 'trbx_id': '0'}, {'realizationreport_id': 296456615, 'date_from': '2025-01-27', 'date_to': '2025-02-02', 'create_dt': '2025-02-03', 'currency_name': 'RUB', 'suppliercontract_code': None, 'rrd_id': 2893379263805, 'gi_id': 0, 'dlv_prc': 0, 'fix_tariff_date_from': '', 'fix_tariff_date_to': '', 'subject_name': 'Удобрения для растений', 'nm_id': 312122034, 'brand_name': 'Фульвогумат Иван Овсинский', 'sa_name': 'триходерма1литр', 'ts_name': '0', 'barcode': '2013533560000', 'doc_type_name': 'Продажа', 'quantity': 1, 'retail_price': 623, 'retail_amount': 507, 'sale_percent': 0, 'commission_percent': 21.04, 'office_name': 'Склад поставщика - везу на склад WB', 'supplier_oper_name': 'Продажа', 'order_dt': '2025-01-25T10:07:43Z', 'sale_dt': '2025-02-01T14:49:49Z', 'rr_dt': '2025-02-01', 'shk_id': 29933166348, 'retail_price_withdisc_rub': 623, 'delivery_amount': 0, 'return_amount': 0, 'delivery_rub': 0, 'gi_box_type_name': '', 'product_discount_for_report': 0, 'supplier_promo': 0, 'rid': 0, 'ppvz_spp_prc': 0.1552, 'ppvz_kvw_prc_base': 0.1753, 'ppvz_kvw_prc': 0.0201, 'sup_rating_prc_up': 0, 'is_kgvp_v2': 0, 'ppvz_sales_commission': 12.56, 'ppvz_for_pay': 483.32, 'ppvz_reward': 0, 'acquiring_fee': 8.61, 'acquiring_percent': 1.7, 'payment_processing': 'Перевыставление эквайринга', 'acquiring_bank': 'Вайлдберриз Банк', 'ppvz_vw': 12.558333333333334, 'ppvz_vw_nds': 2.51, 'ppvz_office_name': 'Московская область деревня Духанино 57с2', 'ppvz_office_id': 50031081, 'ppvz_supplier_id': 0, 'ppvz_supplier_name': '', 'ppvz_inn': '', 'declaration_number': '', 'sticker_id': '29933166348', 'site_country': 'Россия', 'srv_dbs': False, 'penalty': 0, 'additional_payment': 0, 'rebill_logistic_cost': 0, 'storage_fee': 0, 'deduction': 0, 'acceptance': 0, 'assembly_id': 2875983258, 'srid': '7949337545312106843.2.0', 'report_type': 1, 'is_legal_entity': False, 'trbx_id': ''}]
2025-03-02 01:58:49,988 - INFO - Fetching stock data from 2025-02-01
2025-03-02 01:58:51,012 - INFO - Received 18 stock records
2025-03-02 01:58:51,012 - DEBUG - Sample stock data: [{'lastChangeDate': '2025-02-27T07:00:05', 'warehouseName': 'Новосибирск', 'supplierArticle': 'ПП7.5', 'nmId': 333842491, 'barcode': '2042875733360', 'quantity': 0, 'inWayToClient': 0, 'inWayFromClient': 0, 'quantityFull': 0, 'category': 'Строительные материалы', 'subject': 'Профили монтажные', 'brand': '', 'techSize': '0', 'Price': 1700, 'Discount': 5, 'isSupply': True, 'isRealization': False, 'SCCode': 'Tech'}, {'lastChangeDate': '2025-02-27T09:55:25', 'warehouseName': 'Иваново', 'supplierArticle': 'ПП1.1', 'nmId': 333842508, 'barcode': '2042875733124', 'quantity': 0, 'inWayToClient': 0, 'inWayFromClient': 0, 'quantityFull': 0, 'category': 'Строительные материалы', 'subject': 'Профили монтажные', 'brand': '', 'techSize': '0', 'Price': 585, 'Discount': 60, 'isSupply': True, 'isRealization': False, 'SCCode': 'Tech'}]
2025-03-02 01:58:51,012 - INFO - Fetching orders in transit with params: {'limit': 1000, 'next': 0}
2025-03-02 01:58:51,485 - INFO - Received 29 orders in transit
2025-03-02 01:58:51,485 - DEBUG - Sample transit data: [{'address': None, 'scanPrice': 0, 'comment': '', 'deliveryType': 'fbs', 'supplyId': 'WB-GI-135928416', 'orderUid': 'r71c7ef2cd859402ebfa854010075ebd6', 'article': 'К008647', 'colorCode': '', 'rid': 'dW.r71c7ef2cd859402ebfa854010075ebd6.0.0', 'createdAt': '2025-01-31T16:31:47Z', 'offices': ['Новосибирск'], 'skus': ['2039970804491'], 'id': 2905713469, 'warehouseId': 856022, 'nmId': 230519482, 'chrtId': 364036772, 'price': 7662, 'convertedPrice': 220021, 'currencyCode': 933, 'convertedCurrencyCode': 643, 'cargoType': 1, 'isZeroOrder': False}, {'address': None, 'scanPrice': 0, 'comment': '', 'deliveryType': 'fbs', 'supplyId': 'WB-GI-136151423', 'orderUid': '46064137_6217763419006828734', 'article': 'триходерма1литр', 'colorCode': '', 'rid': '6217763419006828734.0.0', 'createdAt': '2025-02-01T13:29:51Z', 'offices': ['Новосибирск'], 'skus': ['2013533560000'], 'id': 2909511318, 'warehouseId': 856022, 'nmId': 312122034, 'chrtId': 471995597, 'price': 57900, 'convertedPrice': 57900, 'currencyCode': 643, 'convertedCurrencyCode': 643, 'cargoType': 1, 'isZeroOrder': False}]
2025-03-02 01:58:51,485 - INFO - Starting generate_sales_excel
2025-03-02 01:58:51,486 - INFO - Processing sales data
2025-03-02 01:58:51,489 - INFO - Calculating summary metrics
2025-03-02 01:58:51,492 - INFO - Processing stock data
2025-03-02 01:58:51,492 - INFO - Processing transit data
2025-03-02 01:58:51,492 - INFO - Generating Excel file
2025-03-02 01:58:51,664 - INFO - Excel file generated: sales_report_2025-02-01_2025-03-01.xlsx
2025-03-02 01:58:51,667 - DEBUG - Calling Bot API endpoint `sendMessage` with parameters `{'chat_id': 6626623279, 'text': 'Отчёт по продажам:\nВсего продаж: 16\nОбщая выручка: 14393,30 руб.\nСредняя выручка на продажу: 899,58 руб.\nПродано единиц: 16\nВозвраты: 1 шт.\nЗатраты на товары: 0,00 руб.\nКомиссия WB: 1384,62 руб.\nЗатраты на доставку: 2242,57 руб.\nЧистая прибыль: 10766,11 руб.\n\nТоп-3 продаваемых товара:\n- триходерма1литр: 6 шт.\n- кп.120.4: 4 шт.\n- кп.121.6: 2 шт.\n⚠️ Товары без закупочной стоимости: к008647, триходерма1литр, к008504, ап15x1.5x1000_5, кп.120.4, к008626, кп.121.6. Укажите через /add_product.\n'}`
2025-03-02 01:58:51,668 - DEBUG - close.started
2025-03-02 01:58:51,669 - DEBUG - close.complete
2025-03-02 01:58:51,669 - DEBUG - connect_tcp.started host='api.telegram.org' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-02 01:58:51,923 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001DF7461C390>
2025-03-02 01:58:51,923 - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001DF72E98290> server_hostname='api.telegram.org' timeout=5.0
2025-03-02 01:58:52,110 - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001DF7461C1D0>
2025-03-02 01:58:52,111 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-02 01:58:52,111 - DEBUG - send_request_headers.complete
2025-03-02 01:58:52,111 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-02 01:58:52,111 - DEBUG - send_request_body.complete
2025-03-02 01:58:52,111 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-02 01:58:52,230 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Server', b'nginx/1.18.0'), (b'Date', b'Sat, 01 Mar 2025 19:02:27 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'2126'), (b'Connection', b'keep-alive'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Allow-Methods', b'GET, POST, OPTIONS'), (b'Access-Control-Expose-Headers', b'Content-Length,Content-Type,Date,Server,Connection')])
2025-03-02 01:58:52,231 - INFO - HTTP Request: POST https://api.telegram.org/bot7210035997:AAETKsY0RI_BnKZNngKY-raSz7mrVRkDmlo/sendMessage "HTTP/1.1 200 OK"
2025-03-02 01:58:52,231 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-02 01:58:52,231 - DEBUG - receive_response_body.complete
2025-03-02 01:58:52,231 - DEBUG - response_closed.started
2025-03-02 01:58:52,231 - DEBUG - response_closed.complete
2025-03-02 01:58:52,232 - DEBUG - Call to Bot API endpoint `sendMessage` finished with return value `{'message_id': 1504, 'from': {'id': 7210035997, 'is_bot': True, 'first_name': 'BotWb', 'username': 'WBZev_bot'}, 'chat': {'id': 6626623279, 'first_name': 'Денис', 'type': 'private'}, 'date': 1740855747, 'text': 'Отчёт по продажам:\nВсего продаж: 16\nОбщая выручка: 14393,30 руб.\nСредняя выручка на продажу: 899,58 руб.\nПродано единиц: 16\nВозвраты: 1 шт.\nЗатраты на товары: 0,00 руб.\nКомиссия WB: 1384,62 руб.\nЗатраты на доставку: 2242,57 руб.\nЧистая прибыль: 10766,11 руб.\n\nТоп-3 продаваемых товара:\n- триходерма1литр: 6 шт.\n- кп.120.4: 4 шт.\n- кп.121.6: 2 шт.\n⚠️ Товары без закупочной стоимости: к008647, триходерма1литр, к008504, ап15x1.5x1000_5, кп.120.4, к008626, кп.121.6. Укажите через /add_product.', 'entities': [{'offset': 478, 'length': 12, 'type': 'bot_command'}]}`
2025-03-02 01:58:52,242 - DEBUG - Calling Bot API endpoint `sendDocument` with parameters `{'chat_id': 6626623279, 'document': <telegram._files.inputfile.InputFile object at 0x000001DF73EA5200>}`
2025-03-02 01:58:52,243 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-02 01:58:52,243 - DEBUG - send_request_headers.complete
2025-03-02 01:58:52,243 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-02 01:58:52,244 - DEBUG - send_request_body.complete
2025-03-02 01:58:52,244 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-02 01:58:52,534 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Server', b'nginx/1.18.0'), (b'Date', b'Sat, 01 Mar 2025 19:02:28 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'512'), (b'Connection', b'keep-alive'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Allow-Methods', b'GET, POST, OPTIONS'), (b'Access-Control-Expose-Headers', b'Content-Length,Content-Type,Date,Server,Connection')])
2025-03-02 01:58:52,534 - INFO - HTTP Request: POST https://api.telegram.org/bot7210035997:AAETKsY0RI_BnKZNngKY-raSz7mrVRkDmlo/sendDocument "HTTP/1.1 200 OK"
2025-03-02 01:58:52,534 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-02 01:58:52,534 - DEBUG - receive_response_body.complete
2025-03-02 01:58:52,534 - DEBUG - response_closed.started
2025-03-02 01:58:52,534 - DEBUG - response_closed.complete
2025-03-02 01:58:52,534 - DEBUG - Call to Bot API endpoint `sendDocument` finished with return value `{'message_id': 1505, 'from': {'id': 7210035997, 'is_bot': True, 'first_name': 'BotWb', 'username': 'WBZev_bot'}, 'chat': {'id': 6626623279, 'first_name': 'Денис', 'type': 'private'}, 'date': 1740855748, 'document': {'file_name': 'sales_report_2025-02-01_2025-03-01.xlsx', 'mime_type': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'file_id': 'BQACAgIAAxkDAAIF4WfDWcT_wPWHGb32SjVhylhuKO_bAAIUbQACFPIZSpGKMpe9yE2ANgQ', 'file_unique_id': 'AgADFG0AAhTyGUo', 'file_size': 9937}}`
2025-03-02 01:58:59,261 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Server', b'nginx/1.18.0'), (b'Date', b'Sat, 01 Mar 2025 19:02:34 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'23'), (b'Connection', b'keep-alive'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Allow-Methods', b'GET, POST, OPTIONS'), (b'Access-Control-Expose-Headers', b'Content-Length,Content-Type,Date,Server,Connection')])
2025-03-02 01:58:59,261 - INFO - HTTP Request: POST https://api.telegram.org/bot7210035997:AAETKsY0RI_BnKZNngKY-raSz7mrVRkDmlo/getUpdates "HTTP/1.1 200 OK"
2025-03-02 01:58:59,261 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-02 01:58:59,261 - DEBUG - receive_response_body.complete
2025-03-02 01:58:59,261 - DEBUG - response_closed.started
2025-03-02 01:58:59,261 - DEBUG - response_closed.complete
2025-03-02 01:58:59,262 - DEBUG - Call to Bot API endpoint `getUpdates` finished with return value `[]`
2025-03-02 01:58:59,262 - DEBUG - No new updates found.
2025-03-02 01:58:59,262 - DEBUG - Calling Bot API endpoint `getUpdates` with parameters `{'timeout': 10, 'offset': 270661547}`
2025-03-02 01:58:59,263 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-02 01:58:59,263 - DEBUG - send_request_headers.complete
2025-03-02 01:58:59,263 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-02 01:58:59,263 - DEBUG - send_request_body.complete
2025-03-02 01:58:59,263 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-02 01:59:09,373 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Server', b'nginx/1.18.0'), (b'Date', b'Sat, 01 Mar 2025 19:02:45 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'23'), (b'Connection', b'keep-alive'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Allow-Methods', b'GET, POST, OPTIONS'), (b'Access-Control-Expose-Headers', b'Content-Length,Content-Type,Date,Server,Connection')])
2025-03-02 01:59:09,374 - INFO - HTTP Request: POST https://api.telegram.org/bot7210035997:AAETKsY0RI_BnKZNngKY-raSz7mrVRkDmlo/getUpdates "HTTP/1.1 200 OK"
2025-03-02 01:59:09,374 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-02 01:59:09,374 - DEBUG - receive_response_body.complete
2025-03-02 01:59:09,374 - DEBUG - response_closed.started
2025-03-02 01:59:09,374 - DEBUG - response_closed.complete
2025-03-02 01:59:09,374 - DEBUG - Call to Bot API endpoint `getUpdates` finished with return value `[]`
2025-03-02 01:59:09,374 - DEBUG - No new updates found.
2025-03-02 01:59:09,374 - DEBUG - Calling Bot API endpoint `getUpdates` with parameters `{'timeout': 10, 'offset': 270661547}`
2025-03-02 01:59:09,375 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-02 01:59:09,375 - DEBUG - send_request_headers.complete
2025-03-02 01:59:09,375 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-02 01:59:09,375 - DEBUG - send_request_body.complete
2025-03-02 01:59:09,375 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-02 01:59:19,475 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Server', b'nginx/1.18.0'), (b'Date', b'Sat, 01 Mar 2025 19:02:55 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'23'), (b'Connection', b'keep-alive'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Allow-Methods', b'GET, POST, OPTIONS'), (b'Access-Control-Expose-Headers', b'Content-Length,Content-Type,Date,Server,Connection')])
2025-03-02 01:59:19,476 - INFO - HTTP Request: POST https://api.telegram.org/bot7210035997:AAETKsY0RI_BnKZNngKY-raSz7mrVRkDmlo/getUpdates "HTTP/1.1 200 OK"
2025-03-02 01:59:19,476 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-02 01:59:19,476 - DEBUG - receive_response_body.complete
2025-03-02 01:59:19,476 - DEBUG - response_closed.started
2025-03-02 01:59:19,476 - DEBUG - response_closed.complete
2025-03-02 01:59:19,476 - DEBUG - Call to Bot API endpoint `getUpdates` finished with return value `[]`
2025-03-02 01:59:19,476 - DEBUG - No new updates found.
2025-03-02 01:59:19,476 - DEBUG - Calling Bot API endpoint `getUpdates` with parameters `{'timeout': 10, 'offset': 270661547}`
2025-03-02 01:59:19,476 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-02 01:59:19,477 - DEBUG - send_request_headers.complete
2025-03-02 01:59:19,477 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-02 01:59:19,477 - DEBUG - send_request_body.complete
2025-03-02 01:59:19,477 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-02 01:59:29,576 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Server', b'nginx/1.18.0'), (b'Date', b'Sat, 01 Mar 2025 19:03:05 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'23'), (b'Connection', b'keep-alive'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Allow-Methods', b'GET, POST, OPTIONS'), (b'Access-Control-Expose-Headers', b'Content-Length,Content-Type,Date,Server,Connection')])
2025-03-02 01:59:29,576 - INFO - HTTP Request: POST https://api.telegram.org/bot7210035997:AAETKsY0RI_BnKZNngKY-raSz7mrVRkDmlo/getUpdates "HTTP/1.1 200 OK"
2025-03-02 01:59:29,576 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-02 01:59:29,576 - DEBUG - receive_response_body.complete
2025-03-02 01:59:29,576 - DEBUG - response_closed.started
2025-03-02 01:59:29,576 - DEBUG - response_closed.complete
2025-03-02 01:59:29,576 - DEBUG - Call to Bot API endpoint `getUpdates` finished with return value `[]`
2025-03-02 01:59:29,576 - DEBUG - No new updates found.
2025-03-02 01:59:29,576 - DEBUG - Calling Bot API endpoint `getUpdates` with parameters `{'timeout': 10, 'offset': 270661547}`
2025-03-02 01:59:29,576 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-02 01:59:29,577 - DEBUG - send_request_headers.complete
2025-03-02 01:59:29,577 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-02 01:59:29,577 - DEBUG - send_request_body.complete
2025-03-02 01:59:29,577 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-02 01:59:39,678 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Server', b'nginx/1.18.0'), (b'Date', b'Sat, 01 Mar 2025 19:03:15 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'23'), (b'Connection', b'keep-alive'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Allow-Methods', b'GET, POST, OPTIONS'), (b'Access-Control-Expose-Headers', b'Content-Length,Content-Type,Date,Server,Connection')])
2025-03-02 01:59:39,678 - INFO - HTTP Request: POST https://api.telegram.org/bot7210035997:AAETKsY0RI_BnKZNngKY-raSz7mrVRkDmlo/getUpdates "HTTP/1.1 200 OK"
2025-03-02 01:59:39,679 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-02 01:59:39,679 - DEBUG - receive_response_body.complete
2025-03-02 01:59:39,679 - DEBUG - response_closed.started
2025-03-02 01:59:39,679 - DEBUG - response_closed.complete
2025-03-02 01:59:39,679 - DEBUG - Call to Bot API endpoint `getUpdates` finished with return value `[]`
2025-03-02 01:59:39,679 - DEBUG - No new updates found.
2025-03-02 01:59:39,680 - DEBUG - Calling Bot API endpoint `getUpdates` with parameters `{'timeout': 10, 'offset': 270661547}`
2025-03-02 01:59:39,680 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-02 01:59:39,680 - DEBUG - send_request_headers.complete
2025-03-02 01:59:39,680 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-02 01:59:39,680 - DEBUG - send_request_body.complete
2025-03-02 01:59:39,680 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-02 01:59:40,611 - DEBUG - Application received stop signal. Shutting down.
2025-03-02 01:59:40,613 - DEBUG - Stopping Updater
2025-03-02 01:59:40,613 - DEBUG - Waiting background polling task to finish up.
2025-03-02 01:59:40,613 - DEBUG - Network loop retry getting Updates was cancelled
2025-03-02 01:59:40,613 - DEBUG - receive_response_headers.failed exception=CancelledError()
2025-03-02 01:59:40,613 - DEBUG - response_closed.started
2025-03-02 01:59:40,613 - DEBUG - Calling `get_updates` one more time to mark all fetched updates as read.
2025-03-02 01:59:40,613 - DEBUG - Calling Bot API endpoint `getUpdates` with parameters `{'timeout': 0, 'offset': 270661547}`
2025-03-02 01:59:40,613 - DEBUG - response_closed.complete
2025-03-02 01:59:40,613 - DEBUG - connect_tcp.started host='api.telegram.org' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-02 01:59:40,865 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001DF74389A50>
2025-03-02 01:59:40,865 - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001DF72E98200> server_hostname='api.telegram.org' timeout=5.0
2025-03-02 01:59:41,089 - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001DF72ADBF90>
2025-03-02 01:59:41,090 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-02 01:59:41,090 - DEBUG - send_request_headers.complete
2025-03-02 01:59:41,090 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-02 01:59:41,090 - DEBUG - send_request_body.complete
2025-03-02 01:59:41,090 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-02 01:59:44,180 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Server', b'nginx/1.18.0'), (b'Date', b'Sat, 01 Mar 2025 19:03:19 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'23'), (b'Connection', b'keep-alive'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Allow-Methods', b'GET, POST, OPTIONS'), (b'Access-Control-Expose-Headers', b'Content-Length,Content-Type,Date,Server,Connection')])
2025-03-02 01:59:44,181 - INFO - HTTP Request: POST https://api.telegram.org/bot7210035997:AAETKsY0RI_BnKZNngKY-raSz7mrVRkDmlo/getUpdates "HTTP/1.1 200 OK"
2025-03-02 01:59:44,181 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-02 01:59:44,181 - DEBUG - receive_response_body.complete
2025-03-02 01:59:44,181 - DEBUG - response_closed.started
2025-03-02 01:59:44,181 - DEBUG - response_closed.complete
2025-03-02 01:59:44,181 - DEBUG - Call to Bot API endpoint `getUpdates` finished with return value `[]`
2025-03-02 01:59:44,181 - DEBUG - No new updates found.
2025-03-02 01:59:44,181 - DEBUG - Updater.stop() is complete
2025-03-02 01:59:44,181 - INFO - Application is stopping. This might take a moment.
2025-03-02 01:59:44,181 - DEBUG - Waiting for update_queue to join
2025-03-02 01:59:44,181 - DEBUG - Application stopped fetching of updates.
2025-03-02 01:59:44,181 - DEBUG - Waiting for running jobs to finish
2025-03-02 01:59:44,181 - INFO - Scheduler has been shut down
2025-03-02 01:59:44,181 - DEBUG - JobQueue stopped
2025-03-02 01:59:44,181 - DEBUG - Waiting for `create_task` calls to be processed
2025-03-02 01:59:44,181 - INFO - Application.stop() complete
2025-03-02 01:59:44,181 - DEBUG - close.started
2025-03-02 01:59:44,181 - DEBUG - close.started
2025-03-02 01:59:44,183 - DEBUG - close.complete
2025-03-02 01:59:44,183 - DEBUG - close.complete
2025-03-02 01:59:44,183 - DEBUG - This Bot is already shut down. Returning.
2025-03-02 01:59:44,183 - DEBUG - Shut down of Updater complete
